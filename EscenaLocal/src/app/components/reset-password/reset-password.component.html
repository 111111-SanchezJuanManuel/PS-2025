<div class="container mt-5" style="max-width: 420px">
  <!-- Estado: cargando token -->
  <div *ngIf="loadingToken" class="text-center py-5">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem" role="status">
      <span class="visually-hidden">Cargando enlace...</span>
    </div>
    <p class="mt-3 text-muted">Verificando enlace de recuperación...</p>
  </div>

  <!-- Estado: formulario -->
  <div *ngIf="!loadingToken">
    <h2 class="text-center mb-4">Restablecer contraseña</h2>

    <!-- Mensaje éxito -->
    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>

    <!-- Mensaje error -->
    <div *ngIf="errorMessage" class="alert alert-danger">
      {{ errorMessage }}
    </div>

    <!-- Solo muestro el formulario si hay token válido y no hay mensaje de éxito -->
    <form
      #resetForm="ngForm"
      (ngSubmit)="onSubmit(resetForm)"
      *ngIf="token && !successMessage"
    >

      <!-- Nueva contraseña -->
      <div class="mb-3">
        <label for="newPassword" class="form-label">Nueva contraseña</label>
        <input
          type="password"
          id="newPassword"
          name="newPassword"
          class="form-control"
          required
          minlength="6"
          [(ngModel)]="newPassword"
          [disabled]="submitting"
        />
        <div
          class="form-text text-danger"
          *ngIf="resetForm.submitted && resetForm.controls['newPassword']?.invalid"
        >
          La contraseña debe tener al menos 6 caracteres.
        </div>
      </div>

      <!-- Confirmar contraseña -->
      <div class="mb-3">
        <label for="confirmPassword" class="form-label">Confirmar contraseña</label>
        <input
          type="password"
          id="confirmPassword"
          name="confirmPassword"
          class="form-control"
          required
          [(ngModel)]="confirmPassword"
          [disabled]="submitting"
        />
        <div
          class="form-text text-danger"
          *ngIf="
            resetForm.submitted &&
            resetForm.controls['confirmPassword']?.valid &&
            newPassword !== confirmPassword
          "
        >
          Las contraseñas no coinciden.
        </div>
      </div>

      <!-- Botón -->
      <button
        type="submit"
        class="btn btn-primary w-100"
        [disabled]="submitting || !token || resetForm.invalid"
      >
        <span *ngIf="!submitting">Guardar nueva contraseña</span>
        <span *ngIf="submitting">
          <span class="spinner-border spinner-border-sm me-2" role="status"></span>
          Guardando...
        </span>
      </button>
    </form>

    <!-- Link a login -->
    <div class="text-center mt-3">
      <button class="btn btn-link p-0" (click)="irAlLogin()">
        Volver al inicio de sesión
      </button>
    </div>
  </div>
</div>

