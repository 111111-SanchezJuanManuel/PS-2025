<div class="dashboard-container">
  <h2>Dashboard Productor</h2>

  
  <form (ngSubmit)="cargarDashboard()" class="filters">
    <label>
      Desde:
      <input type="date" [(ngModel)]="from" name="from">
    </label>
    <label>
      Hasta:
      <input type="date" [(ngModel)]="to" name="to">
    </label>
    <button type="submit">Actualizar</button>
  </form>

  <div *ngIf="loading">Cargando...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <button (click)="verGraficos()">
    Ver gráficos
  </button>

  <ng-container *ngIf="dashboard && !loading">

    
    <div class="kpi-grid">
      <div class="kpi-card">
        <h3>Total recaudado</h3>
        <p>{{ dashboard.kpis.totalRecaudado | currency:'ARS' }}</p>
      </div>
      <div class="kpi-card">
        <h3>Entradas vendidas</h3>
        <p>{{ dashboard.kpis.entradasVendidas }}</p>
      </div>
      <div class="kpi-card">
        <h3>Eventos activos</h3>
        <p>{{ dashboard.kpis.eventosActivos }}</p>
      </div>
      <div class="kpi-card">
      <h3>Ocupación promedio</h3>
      <p>{{ (dashboard.kpis.ocupacionPromedio * 100) | number:'1.0-1' }} %</p>
    </div>

    <div class="kpi-card" *ngIf="dashboard.kpis.mejorEventoNombre">
      <h3>Mejor evento</h3>
      <p>{{ dashboard.kpis.mejorEventoNombre }}</p>
      <small>{{ dashboard.kpis.mejorEventoRecaudacion | currency:'ARS' }}</small>
    </div>
    </div>

    
    <h3>Ventas recientes</h3>
    <table class="table">
      <thead>
      <tr>
        <th>Fecha</th>
        <th>Usuario</th>
        <th>Evento</th>
        <th>Tipo entrada</th>
        <th>Cant.</th>
        <th>Total</th>
        <th>Estado</th>
        <th>PaymentId</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let v of dashboard.ventasRecientes">
        <td>{{ v.fechaCompra | date:'short' }}</td>
        <td>{{ v.usuarioNombre }}<br><small>{{ v.usuarioEmail }}</small></td>
        <td>{{ v.eventoNombre }}</td>
        <td>{{ v.tipoEntradaNombre }}</td>
        <td>{{ v.cantidad }}</td>
        <td>{{ v.total | currency:'ARS' }}</td>
        <td>{{ v.estadoPago }}</td>
        <td>{{ v.paymentId }}</td>
      </tr>
      </tbody>
    </table>

    
    <h3>Eventos</h3>
    <table class="table">
      <thead>
      <tr>
        <th>Evento</th>
        <th>Fecha</th>
        <th>Establecimiento</th>
        <th>Capacidad</th>
        <th>Vendidas</th>
        <th>Ocupación</th>
        <th>Recaudación</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let e of dashboard.eventosResumen">
        <td>{{ e.nombre }}</td>
        <td>{{ e.fecha | date }}</td>
        <td>{{ e.establecimientoNombre }}</td>
        <td>{{ e.capacidadTotal }}</td>
        <td>{{ e.entradasVendidas }}</td>
        <td>{{ (e.porcentajeOcupacion * 100) | number:'1.0-1' }} %</td>
        <td>{{ e.recaudacion | currency:'ARS' }}</td>
      </tr>
      </tbody>
    </table>

    
    <h3>Top eventos por recaudación</h3>
    <table class="table">
      <thead>
      <tr>
        <th>Evento</th>
        <th>Entradas</th>
        <th>Recaudación</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let r of dashboard.topEventos">
        <td>{{ r.eventoNombre }}</td>
        <td>{{ r.entradasVendidas }}</td>
        <td>{{ r.recaudacion | currency:'ARS' }}</td>
      </tr>
      </tbody>
    </table>

  </ng-container>
</div>


